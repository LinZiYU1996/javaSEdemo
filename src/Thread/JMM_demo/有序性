

主要是由于 指令重排 的原因. 指令重排时不会改变单线程情况下的指令语义顺序, 但是不能保证多线程下的运行情况.

例如, 线程A执行 a=2; i=3;, 这两条语句没有相关性, 所以可能被优化为i=3; a=2;,
但是线程B根据A的代码顺序认为a==2时i==3, 这就会因为指令重排产生错误.

